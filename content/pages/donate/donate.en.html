<!DOCTYPE html>
<html lang="en">
<head>
    <title>Donate</title>
    <meta name="slug" content="donate"/>
    <meta name="save_as" content="donate/index.en.html"/>
    <meta name="status" content="hidden"/>
    <meta name="lang" content="en"/>
</head>

<body>
    <h2>
        Cyberduck is <a class="ext" href="http://www.gnu.org/philosophy/free-sw.html">free software</a>, but it
        still costs money to write, support, and distribute it.
        <small>
            As a contributor you receive a registration key that disables the donation prompt. Or buy
            Cyberduck from the <a href="/appstore">Mac App Store</a>.
        </small>
    </h2>

    <h3>Free Software.
        <small><a class="ext" href="http://www.gnu.org/philosophy/free-sw.html">Free
            software</a> is a matter of the users freedom to run, copy,
            distribute, study, change and improve the software. The continued donations of users is what allows
            Cyberduck to be available for free today. If you find this program useful, please
            consider making a donation or buy the version from the <a href="/appstore">Mac App Store</a>.
            It will help to make Cyberduck even better!
        </small>
    </h3>

    <h3>Get a registration key.
        <small> As a contributor (minimum amount 10 USD) you receive a registration key
            that registers the installed application to your name and disables the donation prompt that is
            otherwise displayed after installing or
            updating Cyberduck. The registration key can be used on multiple computers but is personal and is not to
            be shared.
        </small>
    </h3>

    <div class="row">
        <div class="col-sm-8">
            <h3>Payment
                        <span>
                            <img src="//cdn.cyberduck.io/img/paypal.png" height="38px"/>
                            <img src="//cdn.cyberduck.io/img/visa.png"/>
                            <img src="//cdn.cyberduck.io/img/mastercard.png"/>
                            <img src="//cdn.cyberduck.io/img/american_express.png"/>
                        </span>
            </h3>

            <form action="https://reg.cyberduck.io/payment" method="POST" id="payment" role="form">

                <fieldset class="well" id="payment-key">
                    <div class="row">
                        <div class="col-xs-2">
                            <label for="installations">Installations</label>
                            <input class="form-control input-sm" size="5" type="text" id="installations"
                                   name="volume" placeholder="1" autocomplete="off"/>

                            <script>
                                $("#installations").change(function () {
                                    $.get("https://reg.cyberduck.io/calculate", { volume: $("#installations").val() }).done(function(data) {
                                        $("#amount").val($.trim(data));
                                    });
                                });
                            </script>

                            <p class="help-block"></p>
                        </div>
                        <div class="col-xs-2">
                            <label for="currency">Currency</label>
                            <select id="currency" class="form-control input-sm"
                                    name="currency">
                                <option label="€" value="EUR">€</option>
                                <option label="$" value="USD">$</option>
                            </select>

                            <p class="help-block"></p>
                        </div>
                        <div class="col-xs-8">
                            <label for="amount">Amount</label>
                            <input id="amount" name="amount" type="number" class="form-control input-sm" size="4"
                                   placeholder="€" min="10" max="9000" step="any"
                                   value="25" required />

                            <p class="help-block"></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <label for="name">Name</label>
                            <input id="name" type="text" class="form-control input-sm"
                                   data-stripe="name"
                                   name="name"
                                   placeholder="Your Name" required />

                            <p class="help-block">
                                <small>This name will be used to issue the registration key.</small>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <label for="email">Email</label>
                            <input id="email" type="email" class="form-control input-sm"
                                   name="email"
                                   placeholder="Your Email Address" required />

                            <p class="help-block">
                                <small>The registration key will be sent to this address.</small>
                            </p>
                        </div>
                    </div>
                    <input id="platform" type="hidden"
                           name="platform"/>
                </fieldset>

                <div class="well">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#tab-creditcard" aria-controls="home" role="tab" data-toggle="tab">Creditcard</a>
                        </li>
                        <li role="presentation">
                            <a href="#tab-paypal" aria-controls="profile" role="tab" data-toggle="tab">Paypal</a>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="tab-creditcard">
                            <p class="help-block"></p>
                            <fieldset id="payment-creditcard">
                                <div class="row">
                                    <div class="col-xs-9">
                                        <label for="creditcard">Card Number</label>
                                        <img id="visa" src="//cdn.cyberduck.io/img/visa.png" height="20px" style="display: none"/>
                                        <img id="mastercard" src="//cdn.cyberduck.io/img/mastercard.png" height="20px" style="display: none"/>
                                        <img id="amex" src="//cdn.cyberduck.io/img/american_express.png" height="20px" style="display: none"/>
                                        <input id="creditcard" type="text" required
                                               placeholder="Credit Card Number"
                                               class="form-control input-sm" size="20"
                                               data-stripe="number"/>
                                        <script charset="utf-8" type="text/javascript">
                                        //<![CDATA[
                                        $(creditcard).bind("keyup", function (event) {
                                            // MasterCard
                                            if(/^5[1-5]/.test(event.target.value)) {
                                                $(mastercard).show();
                                                $(visa).hide();
                                                $(amex).hide();
                                            }
                                            // Visa
                                            else if(/^4/.test(event.target.value)) {
                                                $(visa).show();
                                                $(mastercard).hide();
                                                $(amex).hide();
                                            }
                                            // AmEx
                                            else if(/^3[47]/.test(event.target.value)) {
                                                $(amex).show();
                                                $(mastercard).hide();
                                                $(visa).hide();
                                            }
                                        });
                                        //]]>
                                        </script>

                                        <p class="help-block"></p>
                                    </div>
                                    <div class="col-xs-3">
                                        <label for="cvc">CVV</label>
                                        <input id="cvc" type="text" required
                                               maxlength="4"
                                               placeholder="Card Security Code"
                                               class="form-control input-sm" size="4"
                                               data-stripe="cvc"/>

                                        <p class="help-block"></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <label for="exp_month">Expiration Month</label>
                                        <select id="exp_month" required="required"
                                                class="form-control input-sm"
                                                data-stripe="exp-exp_month">
                                            <option>01</option>
                                            <option>02</option>
                                            <option>03</option>
                                            <option>04</option>
                                            <option>05</option>
                                            <option>06</option>
                                            <option>07</option>
                                            <option>08</option>
                                            <option>09</option>
                                            <option>10</option>
                                            <option>11</option>
                                            <option>12</option>
                                        </select>

                                        <p class="help-block"></p>
                                    </div>
                                    <div class="col-xs-6">
                                        <label for="exp_year">Expiration Year</label>
                                        <select id="exp_year" class="form-control input-sm"
                                                data-stripe="exp_year">
                                            <option selected>2018</option>
                                            <option>2019</option>
                                            <option>2020</option>
                                            <option>2021</option>
                                            <option>2022</option>
                                            <option>2023</option>
                                            <option>2024</option>
                                            <option>2025</option>
                                        </select>

                                        <p class="help-block"></p>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="tab-paypal">
                            <p class="help-block"></p>
                            <div id="paypal-container" class="text-center">
                                <div id="await-clienttoken" class="progress">
                                    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                                </div>
                                <div id="braintree-paypal-button"></div>
                            </div>
                            <!-- Load PayPal's checkout.js Library. -->
                            <script src="https://www.paypalobjects.com/api/checkout.js" data-version-4 log-level="warn"></script>
                            <!-- Load the client component. -->
                            <script src="https://js.braintreegateway.com/web/3.31.0/js/client.min.js"></script>
                            <!-- Load the PayPal Checkout component. -->
                            <script src="https://js.braintreegateway.com/web/3.31.0/js/paypal-checkout.min.js"></script>
                            <script>
                                $(function() {
                                    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                                        // newly activated tab
                                        var target = $(e.target).attr("href");
                                        if(target == '#tab-paypal') {
                                            if($("form#payment input#token").length) {
                                                // Skip if we already have a token from previous submit or paypal flow
                                                return;
                                            }
                                            if($("#paypal-container").find("#await-clienttoken").length) {
                                                $.get("https://reg.cyberduck.io/paypal/token", function (clientToken) {
                                                    $("#paypal-container").find("#await-clienttoken").remove();
                                                    braintree.client.create({
                                                        authorization: clientToken
                                                    }, function (clientErr, clientInstance) {

                                                      // Stop if there was a problem creating the client.
                                                      // This could happen if there is a network error or if the authorization
                                                      // is invalid.
                                                      if (clientErr) {
                                                        console.error('Error creating client:', clientErr);
                                                        return;
                                                      }

                                                      // Create a PayPal Checkout component.
                                                      braintree.paypalCheckout.create({
                                                        client: clientInstance
                                                      }, function (paypalCheckoutErr, paypalCheckoutInstance) {

                                                        // Stop if there was a problem creating PayPal Checkout.
                                                        // This could happen if there was a network error or if it's incorrectly
                                                        // configured.
                                                        if (paypalCheckoutErr) {
                                                          console.error('Error creating PayPal Checkout:', paypalCheckoutErr);
                                                          return;
                                                        }

                                                        // Set up PayPal with the checkout.js library
                                                        paypal.Button.render({
                                                          env: 'production',
                                                          payment: function () {
                                                            return paypalCheckoutInstance.createPayment({
                                                              flow: 'checkout', // 'vault'
                                                              enableShippingAddress: false,
                                                              enableBillingAddress: false,
                                                              displayName: 'Cyberduck',
                                                              amount: $("#amount").val(),
                                                              currency: $("#currency").val(),
                                                              intent: 'sale',
                                                              landingPageType: 'login',
                                                              headless: true
                                                            });
                                                          },
                                                          onAuthorize: function (data, actions) {
                                                            return paypalCheckoutInstance.tokenizePayment(data)
                                                              .then(function (payload) {
                                                                var form = $("#payment");
                                                                // Insert the token into the form so it gets submitted to the server
                                                                form.append($("<input id='token' type='hidden' name='paypal-nonce' />").val(payload.nonce));
                                                                form.submit();
                                                              });
                                                          },
                                                          onCancel: function (data) {
                                                                $("#payment-creditcard").removeAttr("disabled");
                                                                $("#token").remove();
                                                          },
                                                          onError: function (err) {
                                                                $("#payment-creditcard").removeAttr("disabled");
                                                                $("#token").remove();
                                                          }
                                                        }, '#braintree-paypal-button').then(function () {
                                                                $("#payment-creditcard").attr("disabled", "disabled");
                                                        });
                                                      });
                                                    });
                                                });
                                            }
                                        }
                                    });
                                });
                            </script>
                        </div>
                    </div>
                </div>
                <fieldset class="well" id="payment-submit">
                    <div class="form-group">
                        <p class="help-block"></p>
                        <button type="submit" class="btn btn-default btn-primary btn-sm" id="button-submit">Process Payment</button>
                        <script charset="utf-8" type="text/javascript">
                        //<![CDATA[
                        $(function() {
                            var result = $("#payment-result");
                            var options = {
                                clearForm: false,
                                beforeSubmit: function (arr, form, options) {
                                    result.removeClass("hide");
                                    result.removeClass("alert-danger");
                                    result.addClass("alert-info");
                                    result.text("Processing…");
                                    $("#payment-creditcard").attr("disabled", "disabled");
                                    $("#payment-submit").attr("disabled", "disabled");
                                    $("#payment-key").attr("disabled", "disabled");
                                if($("form#payment input#token").length) {
                                    // Skip if we already have a token from previous submit or paypal flow
                                    return true;
                                }
                                else {
                                        Stripe.card.createToken({
                                                  number: $("#creditcard").val(),
                                                  cvc: $("#cvc").val(),
                                                  exp_month: $("#exp_month").val(),
                                                  exp_year: $("#exp_year").val()
                                                },
                                            function(status, response) {
                                                  var form = $("form#payment");
                                                  if (response.error) {
                                                        // Show the errors on the form
                                                        result.removeClass("alert-info");
                                                        result.addClass("alert-danger");
                                                        result.text(response.error.message);
                                                        $("#payment-creditcard").removeAttr("disabled");
                                                        $("#payment-submit").removeAttr("disabled");
                                                        $("#payment-key").removeAttr("disabled");
                                                  } else {
                                                        // token contains id, last4, and card type
                                                        var token = response.id;

                                                        // Insert the token into the form so it gets submitted to the server
                                                        form.append($("<input id='token' type='hidden' name='stripe-token' />").val(token));
                                                        form.submit();
                                                  }
                                            }
                                    );
                                    // Return false to cancel submit until we have token obtained
                                    return false;
                                    }
                                },
                                success: function (response, status) {
                                    $("#token").remove();
                                    result.addClass("alert-info");
                                    result.text(response);
                                },
                                error: function (response) {
                                    $("#token").remove();
                                    result.removeClass("alert-info");
                                    result.addClass("alert-danger");
                                    result.text(response.responseText);
                                    $("#payment-creditcard").removeAttr("disabled");
                                    $("#payment-submit").removeAttr("disabled");
                                    $("#payment-key").removeAttr("disabled");
                                }
                            };
                            $("form#payment").ajaxForm(options);
                        });
                        //]]>
                        </script>
                    </div>
                </fieldset>
            </form>
            <p id="payment-result" class="alert"></p>
            <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
            <script type="text/javascript">
                Stripe.setPublishableKey("pk_live_jmCwYBkVJsQE4hU5cr94yLfj");
            </script>
        </div>
        <div class="col-sm-4">
            <h4>IBAN</h4>

            <p>
                <small>You can send money by IBAN. You will have to <a
                        href="mailto:feedback@cyberduck.io">request a registration key</a> after the transaction has
                    been completed.
                </small>
            </p>

            <p>
                <tt><strong>To</strong> iterate GmbH</tt><br>
                <tt><strong>Bank</strong> Postfinance, 3030 Bern</tt><br>
                <tt><strong>IBAN</strong> CH72 0900 0000 6068 9419 1</tt><br>
                <tt><strong>SWIFT BIC</strong> POFICHBEXXX</tt></p>

            <p>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-8">
            <a name="recover"></a>
            <h3>Registration Key Recovery</h3>

            <p> The registration key is sent to you by email
                automatically after the transaction has been completed. To recover a
                lost registration key, enter your email address below to look it up.</p>

            <form id="lookup" method="GET" action="https://reg.cyberduck.io/lookup" class="form-inline" role="form">

                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="Email address registered"
                           id="recover-input" name="email"/>
                </div>
                <button type="submit" class="btn btn-default btn-sm">Lookup</button>
                <script charset="utf-8" type="text/javascript">
                    //<![CDATA[
                    $(function() {
                        var options = {
                            target: "#lookup-result",
                            clearForm: true,
                            error: function(e) {
                                $("#lookup-result").text(e.responseText);
                            }
                        };
                        $("form#lookup").ajaxForm(options);
                    });
                    //]]>
                </script>
            </form>

            <p id="lookup-result" class="alert alert-info"></p>

            <p><small>Open the received registration key with Cyberduck by double clicking. Make sure the filename of the
                registration key attached ends with <tt>.cyberducklicense</tt>. Refer to the <a
                        href="https://trac.cyberduck.io/wiki/help/en/faq#DonationKeys">wiki</a> if you have trouble
                receiving or opening the key.</small></p>

            <a name="receipt"></a>
            <h3>Receipt</h3>

            <p>Request a receipt for your bookkeeping.</p>

            <form id="receipt" method="GET" action="https://reg.cyberduck.io/receipt" class="form-inline" role="form">

                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="Email address registered"
                           id="receipt-input" name="email"/>
                </div>
                <button type="submit" class="btn btn-default btn-sm">Lookup</button>
                <script charset="utf-8" type="text/javascript">
                    //<![CDATA[
                    $(function() {
                        var options = {
                            target: "#receipt-result",
                            clearForm: true,
                            error: function(e) {
                                $("#receipt-result").text(e.responseText);
                            }
                        };
                        $("form#receipt").ajaxForm(options);
                    });
                    //]]>
                </script>
            </form>

            <p id="receipt-result" class="alert alert-info"></p>
        </div>
    </div>
    </body>
</html>
